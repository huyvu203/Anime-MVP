flowchart TD
    subgraph "User Interface Layer"
        UI[ğŸ–¥ï¸ Streamlit Chat App<br/>streamlit_app.py]
    end
    
    subgraph "Agent Orchestration"
        WF[âš¡ Sequential Workflow Coordinator<br/>sequential_workflow.py]
    end
    
    subgraph "Two-Agent System"
        UIA[ğŸ§  User Interface Agent<br/>GPT-5-mini + OpenAI API<br/>user_interface_agent.py]
        DRA[ğŸ“Š Data Retrieval Agent<br/>AthenaQueryClient + SQLite<br/>data_retrieval_agent.py]
    end
    
    subgraph "AWS Data Pipeline"
        JIKAN[ğŸŒ Jikan API<br/>fetch_jikan.py]
        S3RAW[ğŸ“ S3 Raw Storage<br/>JSON Files]
        GLUE[âš™ï¸ AWS Glue PySpark ETL<br/>anime_etl.py]
        S3PROC[ğŸ“ S3 Processed Storage<br/>CSV Files]
        ATHENA[ğŸ” AWS Athena<br/>SQL Query Engine<br/>athena_client.py]
    end
    
    subgraph "Personal Data Storage"
        SQLITE[ğŸ“± SQLite Database<br/>User Watch History<br/>personal_watch_history.py]
    end
    
    %% User interaction flow
    UI --> WF
    WF --> UIA
    UIA --> DRA
    DRA --> UIA
    UIA --> WF
    WF --> UI
    
    %% Data pipeline flow
    JIKAN --> S3RAW
    S3RAW --> GLUE
    GLUE --> S3PROC
    S3PROC --> ATHENA
    
    %% Agent data access
    DRA --> ATHENA
    DRA --> SQLITE
    
    %% Styling for components
    classDef userInterface fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef orchestration fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef agents fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef aws fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef personal fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class UI userInterface
    class WF orchestration
    class UIA,DRA agents
    class JIKAN,S3RAW,GLUE,S3PROC,ATHENA aws
    class SQLITE personal
